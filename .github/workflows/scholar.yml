name: Update Google Scholar Citations

on:
  schedule:
    - cron: "0 2 * * *"   # daily
  workflow_dispatch:

permissions:
  contents: write

jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install gsbg
        run: |
          python -m pip install --upgrade pip
          pip install gsbg

      - name: Generate Shields endpoint JSON
        run: |
          python - <<'PY'
          import json
          import gsbg

          profile_link = "https://scholar.google.com/citations?user=RqHme84AAAAJ&hl=en"
          citations = gsbg.fetch_profile_citation_num(profile_link)

          data = {
              "schemaVersion": 1,
              "label": "Citations",
              "message": str(citations),
              "color": "blue"
          }

          with open("scholar-badge.json", "w", encoding="utf-8") as f:
              json.dump(data, f)
          print("Wrote scholar-badge.json:", data)
          PY

      - name: Commit and push if changed
        run: |
          git config user.name "github-actions"
          git config user.email "github-actions@github.com"
          git add scholar-badge.json
          git commit -m "Update Google Scholar citations" || exit 0
          git push
